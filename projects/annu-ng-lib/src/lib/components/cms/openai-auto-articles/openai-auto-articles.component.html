<anu-openai-form [prompts]='historyPrompts' [selectedPromptText]='' [showHistory]='true'
    (goClicked)="onNewPrompt($event)">
</anu-openai-form>

<anu-collapsible *ngIf="errorMsg.length" [collapsed]="false" class="col-12 spacing-around-vertical"
    [hamBurgerClassNames]="['size-sm']" [isDropdownStyle]="true">
    <anu-collapsible-header>
        Queue Messagees
    </anu-collapsible-header>
    <anu-collapsible-content class="row">
        <ol>
            <li *ngFor="let msg of errorMsg" [innerHTML]="msg"></li>
        </ol>
    </anu-collapsible-content>
</anu-collapsible>

<div *ngIf="openaiArticleQueue.length" class="row">
    <div class="col-6"><strong>
            {{ellapsedTime/60}}mins <br />
            <span *ngIf="!isQueueFinished">Writing article {{openaiArticleQueueIndex + 1}} ...</span>
        </strong>
    </div>
    <div class="col-6">
        <a *ngIf="!isQueueFinished" class="btn primary" href="javascript:void(0)"
            (click)="togglePauseQueue()">{{isQueuePaused ? 'Start Queue': 'Pause Queue'}}</a>
    </div>
</div>
<!-- Articles Queue -->
<div class="flex-container spacing-vertical" *ngFor="let artQueue of openaiArticleQueue; let artQindex = index">
    <h2>{{artQueue.name}}</h2>
    <table class="queue">
        <thead>
            <tr>
                <th class="queue_prompt">Prompt</th>
                <th class="queue_status">Status</th>
                <th class="queue_time-taken">Time taken(s)</th>
                <th class="queue_action">
                    <span *ngIf="artQueue.saveStatus">Saved</span>
                    <a *ngIf="!artQueue.saveStatus" class="btn secondary" href="javascript:void(0)"
                        (click)="saveArticle(artQindex)">Save</a>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let queueItem of artQueue.openaiPromptQueue; let pmtQindex = index">
                <td>
                    <small>{{queueItem.name}}</small>
                    <input [readonly]="queueItem.status !== 'notstarted'" type="text"
                        [(ngModel)]="queueItem.prompt.prompt" />
                </td>
                <td
                    [ngClass]="{'error': queueItem.status === 'failed', 'success': queueItem.status === 'completed', 'warning relative': queueItem.status === 'inprogress'}">
                    <anu-spinner [show]="queueItem.status === 'inprogress'"></anu-spinner>
                    <strong>{{queueItem.status}}</strong>
                </td>
                <td>{{queueItem.timeTaken / 1000}}s</td>
                <td>
                    <a *ngIf="queueItem.status === 'notstarted'" class="error" href="javascript:void(0)"
                        (click)="removePromptFromQueue(artQindex, pmtQindex)">X</a>
                </td>
            </tr>
            <tr
                *ngIf="(openaiArticleQueueIndex < artQindex || (openaiArticleQueueIndex === artQindex && openaiPromptQueueIndex < artQueue.openaiPromptQueue.length))">
                <td>
                    <small>{{artQueue.promptQueueItemToAdd.name}}</small>
                    <input type="text" [(ngModel)]="artQueue.promptQueueItemToAdd.prompt.prompt" />
                </td>
                <td
                    [ngClass]="{'error': artQueue.promptQueueItemToAdd.status === 'failed', 'success': artQueue.promptQueueItemToAdd.status === 'completed', 'warning relative': artQueue.promptQueueItemToAdd.status === 'inprogress'}">
                    <anu-spinner [show]="artQueue.promptQueueItemToAdd.status === 'inprogress'"></anu-spinner>
                    {{artQueue.promptQueueItemToAdd.status}}
                </td>
                <td>{{artQueue.promptQueueItemToAdd.timeTaken}}</td>
                <td>
                    <a class="primary" href="javascript:void(0)" (click)="addPromptToArticleQueue(artQindex)">Add</a>
                </td>
            </tr>
        </tbody>
    </table>

</div>
